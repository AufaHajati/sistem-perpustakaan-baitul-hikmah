// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// Buat class Login, table userAccount & userPreference

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model PetugasPerpustakaan {
  id   String @id
  nama String
}

model Buku {
  id            Int       @default(autoincrement())
  isbn          String
  judul         String
  penulis       String[]
  genre         Genre[]
  penerbit      String?
  halaman       Int?
  linkGambar    String?   @map("link_gambar")
  sinopsis      String?
  posisi        String?
  tanggalRusak  DateTime? @map("tanggal_rusak")
  tanggalHilang DateTime? @map("tanggal_hilang")

  bukuPinjaman  BukuPinjaman[]
  formBukti     FormBukti[]
  sumbanganBuku SumbanganBuku[]

  @@id([isbn, id])
}

model Murid {
  nis          String       @id
  nama         String
  jenisKelamin JenisKelamin @map("jenis_kelamin")
  kontak       String
  alamat       String?

  FormBukti    FormBukti[]
  Peminjaman   Peminjaman[]
  riwayatKelas RiwayatKelas[]
  sumbangan    Sumbangan[]
}

model Guru {
  nip          String       @id
  nama         String
  jenisKelamin JenisKelamin
  kontak       String
  alamat       String?
  sumbangan    Sumbangan[]
  peminjaman   Peminjaman[]
}

model RiwayatKelas {
  tahunAjaran String

  muridNIS String
  murid    Murid  @relation(fields: [muridNIS], references: [nis])

  idKelas String
  kelas   Kelas  @relation(fields: [idKelas], references: [id])

  @@id([muridNIS, idKelas])
}

model Kelas {
  id      String @id @default(uuid())
  nama    String
  tingkat Int

  RiwayatKelas RiwayatKelas[]
}

model FormBukti {
  id           String   @id @default(uuid())
  tanggal      DateTime @default(now())
  halamanAwal  Int
  halamanAkhir Int
  intisari     String
  status       Boolean

  muridNIS String
  murid    Murid  @relation(fields: [muridNIS], references: [nis])

  bukuId   Int
  bukuISBN String
  Buku     Buku   @relation(fields: [bukuISBN, bukuId], references: [isbn, id])
}

model Peminjaman {
  id            String   @id @default(uuid())
  tanggalPinjam DateTime @default(now())
  keterangan    String?

  bukuPinjaman BukuPinjaman[]

  nis   String? @map("murid_nis")
  murid Murid?  @relation(fields: [nis], references: [nis])

  nip  String? @map("guru_nip")
  guru Guru?   @relation(fields: [nip], references: [nip])
}

model BukuPinjaman {
  tanggalKembali DateTime?
  tenggatWaktu   DateTime

  denda Denda[]

  idPeminjaman String
  peminjaman   Peminjaman @relation(fields: [idPeminjaman], references: [id])

  bukuISBN String
  bukuId   Int
  buku     Buku   @relation(fields: [bukuISBN, bukuId], references: [isbn, id])

  @@id([idPeminjaman, bukuISBN, bukuId])
}

model Keterangan {
  id             String      @id @default(uuid())
  keterangan     String
  jumlahBuku     Int?
  totalNominal   Int?
  nominalPerHari Int?
  sumbangan      Sumbangan[]
}

model Denda {
  id      String   @id @default(uuid())
  tanggal DateTime @default(now())

  bukuId       Int?
  bukuISBN     String?
  idPeminjaman String?
  bukuPinjaman BukuPinjaman? @relation(fields: [idPeminjaman, bukuISBN, bukuId], references: [idPeminjaman, bukuISBN, bukuId])

  idSumbangan String    @unique
  sumbangan   Sumbangan @relation(fields: [idSumbangan], references: [id])

  @@unique([idPeminjaman, bukuISBN, bukuId])
}

model Sumbangan {
  id             String    @id @default(uuid())
  tanggalSelesai DateTime?
  berlebih       Boolean

  pembayaranTunai      PembayaranTunai[]
  riwayatBantuan       RiwayatBantuan[]
  sumbanganBuku        SumbanganBuku[]   @relation("sumbangan")
  sumbanganBukuBantuan SumbanganBuku[]   @relation("sumbanganBantuan")

  denda Denda?

  idKeterangan String
  keterangan   Keterangan @relation(fields: [idKeterangan], references: [id])

  nis   String?
  murid Murid?  @relation(fields: [nis], references: [nis])

  nip  String?
  guru Guru?   @relation(fields: [nip], references: [nip])
}

model SumbanganBuku {
  tanggal DateTime @default(now())

  idSumbangan String
  sumbangan   Sumbangan @relation("sumbangan", fields: [idSumbangan], references: [id])

  idSumbanganBantuan String?
  sumbanganBantuan   Sumbangan? @relation("sumbanganBantuan", fields: [idSumbanganBantuan], references: [id])

  bukuId   Int
  bukuISBN String
  buku     Buku   @relation(fields: [bukuISBN, bukuId], references: [isbn, id])

  @@id([idSumbangan, bukuISBN, bukuId])
}

model PembayaranTunai {
  id      String   @id @default(uuid())
  tanggal DateTime @default(now())
  jumlah  Int

  riwayatBantuan RiwayatBantuan[]

  idSumbangan String
  sumbangan   Sumbangan @relation(fields: [idSumbangan], references: [id])
}

model RiwayatBantuan {
  jumlah Int

  idPembayaranTunai String
  pembayaranTunai   PembayaranTunai @relation(fields: [idPembayaranTunai], references: [id])

  idSumbangan String
  sumbangan   Sumbangan @relation(fields: [idSumbangan], references: [id])

  @@id([idPembayaranTunai, idSumbangan])
}

enum JenisKelamin {
  LAKI
  PEREMPUAN
}

enum Genre {
  FANTASY
  SCIFI
  MYSTERY
  BIOGRAPHY
  HISTORY
  ROMANCE
}

enum Posisi {
  A1
  B1
}

enum StatBuku {
  TERSEDIA
  HABIS
}

enum KetBuku {
  SUMBANGAN
  DENDA
}

enum StatDenda {
  TERLAMBAT
  HILANG
  RUSAK
}

enum KetDenda {
  DIBAYAR
  BELUM
}

enum Jumlah {
  RP500
  RP110000
  DUA_BUKU
}
